<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>METAR</title>

</head>

<body>
  <h1>METAR</h1>

  <script>
    let stations;

    //stations = 'https://aviationweather.gov/windtemp/data?level=l&fcst=06&region=all&layout=off'
    //stations = 'http://weather.rap.ucar.edu/surface/stations.txt';
    //stations = 'https://www.aviationweather.gov/docs/metar/stations.txt';

    function parseJSON(response) {
      //document.getElementById("output").innerHTML = response.bar;
      console.log('JSONP Response:', response);
    };

    // aviationweather does not work with cors, should allow jsonp with ?jsonp=myFunc
    stations = 'https://aviationweather.gov/gis/scripts/MetarSiteJSON.php?' + 'jsonp=parseJSON';

    let url = new URL(stations);

    // outputs the url
    console.log('url:', url);
    console.log('url.href:', url.href);  // console.log('url.toString():', url.toString());
    console.log('url.hostname:', url.hostname);
    console.log('url.pathname:', url.pathname);
    console.log('url.search:', url.search);

    // play around
    console.log('slice:', url.search.slice(1)); // slice(1) chops off leading ?
    console.log('url.searchParams:', url.searchParams);
    //let urlSearchParams = url.searchParams;

    console.log('url.searchParams.toString():', url.searchParams.toString());
    console.log('url.searchParams.entries[]:');
    for (var pair of url.searchParams.entries()) {
      console.log('\t' + pair + ' [' + pair[0] + ', ' + pair[1] + ']');
    }

    let urlSearchParams = new URLSearchParams(url.searchParams);
    console.log('urlSearchParams.toString():', urlSearchParams.toString());

// TODO for the hell of it construct urlSearchParams using constructor

    console.log('stations', stations);

    let params = new URLSearchParams(url.search.slice(1));
    console.log('_params:', params);

    // constructing from an object might be deprecated!
    params = new URLSearchParams(stations.search);
    console.log('_params', params);


    var urlParams = new URLSearchParams(stations);

    //console.log(urlParams.get('action')); // "edit"
    //console.log(urlParams.getAll('action')); // ["edit"]
    //console.log(urlParams.toString());
    //console.log(urlParams.append('active', '1'));



    var tag = document.createElement("script");
    tag.src = stations;
    tag.type = 'application/javascript';
    // note application/javascript was a problem!
    document.getElementsByTagName("head")[0].appendChild(tag);
  </script>


</body>

</html>
